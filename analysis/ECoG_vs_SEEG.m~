clear all

base_path = '/Users/jbernabei/Documents/PhD_Research/ecog_seeg/ecog_vs_seeg';
iEEG_atlas_path = '/Users/jbernabei/Documents/PhD_Research/atlas_project/iEEG_atlas';

[all_patients, all_inds, all_locs, conn_field, coords_field, hasData_field,... 
    id_field,implant_field, outcome_field, resect_field, roi_field,...
    target_field, therapy_field] = set_up_workspace(iEEG_atlas_path);

%% 1. Patient-specific base network renderings

good_ecog_patient_indices = find([hasData_field{:}] & strcmp(outcome_field,'good') & strcmp(implant_field,'ECoG'));
good_seeg_patient_indices = find([hasData_field{:}] & strcmp(outcome_field,'good') & strcmp(implant_field,'SEEG'));

ecog_patients = all_patients(good_ecog_patient_indices);
seeg_patients = all_patients(good_seeg_patient_indices);

rendering_filename = 'base_rendering.png';

create_rendering(rendering_filename, {ecog_patients.coords}, {ecog_patients.conn}, {ecog_patients.patientID});
create_rendering(rendering_filename, {seeg_patients.coords}, {seeg_patients.conn}, {seeg_patients.patientID});

%% 2A. Anatomical targets, broken down by implant type and target (Frontal, Temporal, other)

ecog_temporal_indices = find([hasData_field{:}] & strcmp(outcome_field,'good')...
    & strcmp(implant_field,'ECoG') & (strcmp(target_field,'Temporal') | strcmp(target_field,'MTL')));
ecog_frontal_indices = find([hasData_field{:}] & strcmp(outcome_field,'good')...
    & strcmp(implant_field,'ECoG') & (strcmp(target_field,'Frontal') | strcmp(target_field,'MFL') | strcmp(target_field,'FP')));

seeg_temporal_indices = find([hasData_field{:}] & strcmp(outcome_field,'good')...
    & strcmp(implant_field,'SEEG') & (strcmp(target_field,'Temporal') | strcmp(target_field,'MTL')));
seeg_frontal_indices = find([hasData_field{:}] & strcmp(outcome_field,'good')...
    & strcmp(implant_field,'SEEG') & (strcmp(target_field,'Frontal') | strcmp(target_field,'MFL') | strcmp(target_field,'FP')));

ecog_temporal_patients = all_patients(ecog_temporal_indices);
rank_anatomical_targets({ecog_temporal_patients.patientID},{ecog_temporal_patients.roi},...
    {ecog_temporal_patients.laterality}, all_inds, all_locs,'ECoG','Temporal','plot1.fig');

ecog_frontal_patients = all_patients(ecog_frontal_indices);
rank_anatomical_targets({ecog_frontal_patients.patientID},{ecog_frontal_patients.roi},...
    {ecog_frontal_patients.laterality}, all_inds, all_locs,'ECoG','Frontal','plot2.fig');

seeg_temporal_patients = all_patients(seeg_temporal_indices);
rank_anatomical_targets({seeg_temporal_patients.patientID},{seeg_temporal_patients.roi},...
    {seeg_temporal_patients.laterality}, all_inds, all_locs,'SEEG','Temporal','plot3.fig');

seeg_frontal_patients = all_patients(seeg_frontal_indices);
rank_anatomical_targets({seeg_frontal_patients.patientID},{seeg_frontal_patients.roi},...
    {seeg_frontal_patients.laterality}, all_inds, all_locs,'SEEG','Frontal','plot4.fig');


h1 = openfig('output/supplemental_figures/plot1.fig','reuse'); 
h2 = openfig('output/supplemental_figures/plot2.fig','reuse');
h3 = openfig('output/supplemental_figures/plot3.fig','reuse'); 
h4 = openfig('output/supplemental_figures/plot4.fig','reuse');

% this needs some small fixes

%% 2B. Interelectrode distance comparison

[ecog_distances_all, ecog_distances_pt] = compute_interelectrode_distances({ecog_patients.coords});
[seeg_distances_all, seeg_distances_pt] = compute_interelectrode_distances({seeg_patients.coords});

%% 2C. Connectivity analysis

% histogram of raw values / edge variability for each node -> lets do HG
% break down each histogram / bar by region (intra ROI / inter ROI)

%% 3A. Small worldness (or other global metric)

% using weighted small world propensity from Sarah Muldoon / Bassett

%% 3B. Modularity analysis -> compute modularity & participation coefficient

% General Louvain

%% 3C. Comparison of modules to Yeo systems & own electrode groups

%% 4A. Node strength of the SOZ/EZ

% simple sum

%% 4B. Betweenness centrality of the SOZ/EZ

% BCT

%% 4C. Control centrality of the SOZ/EZ

% custom function

%% 5A. Localization based on top metric -> all nodes

% need 2 localization methods

%% 5B. Localization based on top metric -> no WM

%% 5C. Localization based on top metric -> ROI reduced